(function(){var t=this,e=t._,n=Array.prototype,a=Object.prototype,i=Function.prototype,r=n.push,s=n.slice,o=n.concat,l=a.toString,c=a.hasOwnProperty,u=Array.isArray,d=Object.keys,h=i.bind,p=function(t){return t instanceof p?t:this instanceof p?void(this._wrapped=t):new p(t)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=p),exports._=p):t._=p,p.VERSION="1.7.0";var f=function(t,e,n){if(void 0===e)return t;switch(null==n?3:n){case 1:return function(n){return t.call(e,n)};case 2:return function(n,a){return t.call(e,n,a)};case 3:return function(n,a,i){return t.call(e,n,a,i)};case 4:return function(n,a,i,r){return t.call(e,n,a,i,r)}}return function(){return t.apply(e,arguments)}};p.iteratee=function(t,e,n){return null==t?p.identity:p.isFunction(t)?f(t,e,n):p.isObject(t)?p.matches(t):p.property(t)},p.each=p.forEach=function(t,e,n){if(null==t)return t;e=f(e,n);var a,i=t.length;if(i===+i)for(a=0;i>a;a++)e(t[a],a,t);else{var r=p.keys(t);for(a=0,i=r.length;i>a;a++)e(t[r[a]],r[a],t)}return t},p.map=p.collect=function(t,e,n){if(null==t)return[];e=p.iteratee(e,n);for(var a,i=t.length!==+t.length&&p.keys(t),r=(i||t).length,s=Array(r),o=0;r>o;o++)a=i?i[o]:o,s[o]=e(t[a],a,t);return s};var m="Reduce of empty array with no initial value";p.reduce=p.foldl=p.inject=function(t,e,n,a){null==t&&(t=[]),e=f(e,a,4);var i,r=t.length!==+t.length&&p.keys(t),s=(r||t).length,o=0;if(3>arguments.length){if(!s)throw new TypeError(m);n=t[r?r[o++]:o++]}for(;s>o;o++)i=r?r[o]:o,n=e(n,t[i],i,t);return n},p.reduceRight=p.foldr=function(t,e,n,a){null==t&&(t=[]),e=f(e,a,4);var i,r=t.length!==+t.length&&p.keys(t),s=(r||t).length;if(3>arguments.length){if(!s)throw new TypeError(m);n=t[r?r[--s]:--s]}for(;s--;)i=r?r[s]:s,n=e(n,t[i],i,t);return n},p.find=p.detect=function(t,e,n){var a;return e=p.iteratee(e,n),p.some(t,function(t,n,i){return e(t,n,i)?(a=t,!0):void 0}),a},p.filter=p.select=function(t,e,n){var a=[];return null==t?a:(e=p.iteratee(e,n),p.each(t,function(t,n,i){e(t,n,i)&&a.push(t)}),a)},p.reject=function(t,e,n){return p.filter(t,p.negate(p.iteratee(e)),n)},p.every=p.all=function(t,e,n){if(null==t)return!0;e=p.iteratee(e,n);var a,i,r=t.length!==+t.length&&p.keys(t),s=(r||t).length;for(a=0;s>a;a++)if(i=r?r[a]:a,!e(t[i],i,t))return!1;return!0},p.some=p.any=function(t,e,n){if(null==t)return!1;e=p.iteratee(e,n);var a,i,r=t.length!==+t.length&&p.keys(t),s=(r||t).length;for(a=0;s>a;a++)if(i=r?r[a]:a,e(t[i],i,t))return!0;return!1},p.contains=p.include=function(t,e){return null==t?!1:(t.length!==+t.length&&(t=p.values(t)),p.indexOf(t,e)>=0)},p.invoke=function(t,e){var n=s.call(arguments,2),a=p.isFunction(e);return p.map(t,function(t){return(a?e:t[e]).apply(t,n)})},p.pluck=function(t,e){return p.map(t,p.property(e))},p.where=function(t,e){return p.filter(t,p.matches(e))},p.findWhere=function(t,e){return p.find(t,p.matches(e))},p.max=function(t,e,n){var a,i,r=-1/0,s=-1/0;if(null==e&&null!=t){t=t.length===+t.length?t:p.values(t);for(var o=0,l=t.length;l>o;o++)a=t[o],a>r&&(r=a)}else e=p.iteratee(e,n),p.each(t,function(t,n,a){i=e(t,n,a),(i>s||i===-1/0&&r===-1/0)&&(r=t,s=i)});return r},p.min=function(t,e,n){var a,i,r=1/0,s=1/0;if(null==e&&null!=t){t=t.length===+t.length?t:p.values(t);for(var o=0,l=t.length;l>o;o++)a=t[o],r>a&&(r=a)}else e=p.iteratee(e,n),p.each(t,function(t,n,a){i=e(t,n,a),(s>i||1/0===i&&1/0===r)&&(r=t,s=i)});return r},p.shuffle=function(t){for(var e,n=t&&t.length===+t.length?t:p.values(t),a=n.length,i=Array(a),r=0;a>r;r++)e=p.random(0,r),e!==r&&(i[r]=i[e]),i[e]=n[r];return i},p.sample=function(t,e,n){return null==e||n?(t.length!==+t.length&&(t=p.values(t)),t[p.random(t.length-1)]):p.shuffle(t).slice(0,Math.max(0,e))},p.sortBy=function(t,e,n){return e=p.iteratee(e,n),p.pluck(p.map(t,function(t,n,a){return{value:t,index:n,criteria:e(t,n,a)}}).sort(function(t,e){var n=t.criteria,a=e.criteria;if(n!==a){if(n>a||void 0===n)return 1;if(a>n||void 0===a)return-1}return t.index-e.index}),"value")};var v=function(t){return function(e,n,a){var i={};return n=p.iteratee(n,a),p.each(e,function(a,r){var s=n(a,r,e);t(i,a,s)}),i}};p.groupBy=v(function(t,e,n){p.has(t,n)?t[n].push(e):t[n]=[e]}),p.indexBy=v(function(t,e,n){t[n]=e}),p.countBy=v(function(t,e,n){p.has(t,n)?t[n]++:t[n]=1}),p.sortedIndex=function(t,e,n,a){n=p.iteratee(n,a,1);for(var i=n(e),r=0,s=t.length;s>r;){var o=r+s>>>1;i>n(t[o])?r=o+1:s=o}return r},p.toArray=function(t){return t?p.isArray(t)?s.call(t):t.length===+t.length?p.map(t,p.identity):p.values(t):[]},p.size=function(t){return null==t?0:t.length===+t.length?t.length:p.keys(t).length},p.partition=function(t,e,n){e=p.iteratee(e,n);var a=[],i=[];return p.each(t,function(t,n,r){(e(t,n,r)?a:i).push(t)}),[a,i]},p.first=p.head=p.take=function(t,e,n){return null==t?void 0:null==e||n?t[0]:0>e?[]:s.call(t,0,e)},p.initial=function(t,e,n){return s.call(t,0,Math.max(0,t.length-(null==e||n?1:e)))},p.last=function(t,e,n){return null==t?void 0:null==e||n?t[t.length-1]:s.call(t,Math.max(t.length-e,0))},p.rest=p.tail=p.drop=function(t,e,n){return s.call(t,null==e||n?1:e)},p.compact=function(t){return p.filter(t,p.identity)};var _=function(t,e,n,a){if(e&&p.every(t,p.isArray))return o.apply(a,t);for(var i=0,s=t.length;s>i;i++){var l=t[i];p.isArray(l)||p.isArguments(l)?e?r.apply(a,l):_(l,e,n,a):n||a.push(l)}return a};p.flatten=function(t,e){return _(t,e,!1,[])},p.without=function(t){return p.difference(t,s.call(arguments,1))},p.uniq=p.unique=function(t,e,n,a){if(null==t)return[];p.isBoolean(e)||(a=n,n=e,e=!1),null!=n&&(n=p.iteratee(n,a));for(var i=[],r=[],s=0,o=t.length;o>s;s++){var l=t[s];if(e)s&&r===l||i.push(l),r=l;else if(n){var c=n(l,s,t);0>p.indexOf(r,c)&&(r.push(c),i.push(l))}else 0>p.indexOf(i,l)&&i.push(l)}return i},p.union=function(){return p.uniq(_(arguments,!0,!0,[]))},p.intersection=function(t){if(null==t)return[];for(var e=[],n=arguments.length,a=0,i=t.length;i>a;a++){var r=t[a];if(!p.contains(e,r)){for(var s=1;n>s&&p.contains(arguments[s],r);s++);s===n&&e.push(r)}}return e},p.difference=function(t){var e=_(s.call(arguments,1),!0,!0,[]);return p.filter(t,function(t){return!p.contains(e,t)})},p.zip=function(t){if(null==t)return[];for(var e=p.max(arguments,"length").length,n=Array(e),a=0;e>a;a++)n[a]=p.pluck(arguments,a);return n},p.object=function(t,e){if(null==t)return{};for(var n={},a=0,i=t.length;i>a;a++)e?n[t[a]]=e[a]:n[t[a][0]]=t[a][1];return n},p.indexOf=function(t,e,n){if(null==t)return-1;var a=0,i=t.length;if(n){if("number"!=typeof n)return a=p.sortedIndex(t,e),t[a]===e?a:-1;a=0>n?Math.max(0,i+n):n}for(;i>a;a++)if(t[a]===e)return a;return-1},p.lastIndexOf=function(t,e,n){if(null==t)return-1;var a=t.length;for("number"==typeof n&&(a=0>n?a+n+1:Math.min(a,n+1));--a>=0;)if(t[a]===e)return a;return-1},p.range=function(t,e,n){1>=arguments.length&&(e=t||0,t=0),n=n||1;for(var a=Math.max(Math.ceil((e-t)/n),0),i=Array(a),r=0;a>r;r++,t+=n)i[r]=t;return i};var g=function(){};p.bind=function(t,e){var n,a;if(h&&t.bind===h)return h.apply(t,s.call(arguments,1));if(!p.isFunction(t))throw new TypeError("Bind must be called on a function");return n=s.call(arguments,2),a=function(){if(!(this instanceof a))return t.apply(e,n.concat(s.call(arguments)));g.prototype=t.prototype;var i=new g;g.prototype=null;var r=t.apply(i,n.concat(s.call(arguments)));return p.isObject(r)?r:i}},p.partial=function(t){var e=s.call(arguments,1);return function(){for(var n=0,a=e.slice(),i=0,r=a.length;r>i;i++)a[i]===p&&(a[i]=arguments[n++]);for(;arguments.length>n;)a.push(arguments[n++]);return t.apply(this,a)}},p.bindAll=function(t){var e,n,a=arguments.length;if(1>=a)throw Error("bindAll must be passed function names");for(e=1;a>e;e++)n=arguments[e],t[n]=p.bind(t[n],t);return t},p.memoize=function(t,e){var n=function(a){var i=n.cache,r=e?e.apply(this,arguments):a;return p.has(i,r)||(i[r]=t.apply(this,arguments)),i[r]};return n.cache={},n},p.delay=function(t,e){var n=s.call(arguments,2);return setTimeout(function(){return t.apply(null,n)},e)},p.defer=function(t){return p.delay.apply(p,[t,1].concat(s.call(arguments,1)))},p.throttle=function(t,e,n){var a,i,r,s=null,o=0;n||(n={});var l=function(){o=n.leading===!1?0:p.now(),s=null,r=t.apply(a,i),s||(a=i=null)};return function(){var c=p.now();o||n.leading!==!1||(o=c);var u=e-(c-o);return a=this,i=arguments,0>=u||u>e?(clearTimeout(s),s=null,o=c,r=t.apply(a,i),s||(a=i=null)):s||n.trailing===!1||(s=setTimeout(l,u)),r}},p.debounce=function(t,e,n){var a,i,r,s,o,l=function(){var c=p.now()-s;e>c&&c>0?a=setTimeout(l,e-c):(a=null,n||(o=t.apply(r,i),a||(r=i=null)))};return function(){r=this,i=arguments,s=p.now();var c=n&&!a;return a||(a=setTimeout(l,e)),c&&(o=t.apply(r,i),r=i=null),o}},p.wrap=function(t,e){return p.partial(e,t)},p.negate=function(t){return function(){return!t.apply(this,arguments)}},p.compose=function(){var t=arguments,e=t.length-1;return function(){for(var n=e,a=t[e].apply(this,arguments);n--;)a=t[n].call(this,a);return a}},p.after=function(t,e){return function(){return 1>--t?e.apply(this,arguments):void 0}},p.before=function(t,e){var n;return function(){return--t>0?n=e.apply(this,arguments):e=null,n}},p.once=p.partial(p.before,2),p.keys=function(t){if(!p.isObject(t))return[];if(d)return d(t);var e=[];for(var n in t)p.has(t,n)&&e.push(n);return e},p.values=function(t){for(var e=p.keys(t),n=e.length,a=Array(n),i=0;n>i;i++)a[i]=t[e[i]];return a},p.pairs=function(t){for(var e=p.keys(t),n=e.length,a=Array(n),i=0;n>i;i++)a[i]=[e[i],t[e[i]]];return a},p.invert=function(t){for(var e={},n=p.keys(t),a=0,i=n.length;i>a;a++)e[t[n[a]]]=n[a];return e},p.functions=p.methods=function(t){var e=[];for(var n in t)p.isFunction(t[n])&&e.push(n);return e.sort()},p.extend=function(t){if(!p.isObject(t))return t;for(var e,n,a=1,i=arguments.length;i>a;a++){e=arguments[a];for(n in e)c.call(e,n)&&(t[n]=e[n])}return t},p.pick=function(t,e,n){var a,i={};if(null==t)return i;if(p.isFunction(e)){e=f(e,n);for(a in t){var r=t[a];e(r,a,t)&&(i[a]=r)}}else{var l=o.apply([],s.call(arguments,1));t=Object(t);for(var c=0,u=l.length;u>c;c++)a=l[c],a in t&&(i[a]=t[a])}return i},p.omit=function(t,e,n){if(p.isFunction(e))e=p.negate(e);else{var a=p.map(o.apply([],s.call(arguments,1)),String);e=function(t,e){return!p.contains(a,e)}}return p.pick(t,e,n)},p.defaults=function(t){if(!p.isObject(t))return t;for(var e=1,n=arguments.length;n>e;e++){var a=arguments[e];for(var i in a)void 0===t[i]&&(t[i]=a[i])}return t},p.clone=function(t){return p.isObject(t)?p.isArray(t)?t.slice():p.extend({},t):t},p.tap=function(t,e){return e(t),t};var b=function(t,e,n,a){if(t===e)return 0!==t||1/t===1/e;if(null==t||null==e)return t===e;t instanceof p&&(t=t._wrapped),e instanceof p&&(e=e._wrapped);var i=l.call(t);if(i!==l.call(e))return!1;switch(i){case"[object RegExp]":case"[object String]":return""+t==""+e;case"[object Number]":return+t!==+t?+e!==+e:0===+t?1/+t===1/e:+t===+e;case"[object Date]":case"[object Boolean]":return+t===+e}if("object"!=typeof t||"object"!=typeof e)return!1;for(var r=n.length;r--;)if(n[r]===t)return a[r]===e;var s=t.constructor,o=e.constructor;if(s!==o&&"constructor"in t&&"constructor"in e&&!(p.isFunction(s)&&s instanceof s&&p.isFunction(o)&&o instanceof o))return!1;n.push(t),a.push(e);var c,u;if("[object Array]"===i){if(c=t.length,u=c===e.length)for(;c--&&(u=b(t[c],e[c],n,a)););}else{var d,h=p.keys(t);if(c=h.length,u=p.keys(e).length===c)for(;c--&&(d=h[c],u=p.has(e,d)&&b(t[d],e[d],n,a)););}return n.pop(),a.pop(),u};p.isEqual=function(t,e){return b(t,e,[],[])},p.isEmpty=function(t){if(null==t)return!0;if(p.isArray(t)||p.isString(t)||p.isArguments(t))return 0===t.length;for(var e in t)if(p.has(t,e))return!1;return!0},p.isElement=function(t){return!(!t||1!==t.nodeType)},p.isArray=u||function(t){return"[object Array]"===l.call(t)},p.isObject=function(t){var e=typeof t;return"function"===e||"object"===e&&!!t},p.each(["Arguments","Function","String","Number","Date","RegExp"],function(t){p["is"+t]=function(e){return l.call(e)==="[object "+t+"]"}}),p.isArguments(arguments)||(p.isArguments=function(t){return p.has(t,"callee")}),true&&(p.isFunction=function(t){return"function"==typeof t||!1}),p.isFinite=function(t){return isFinite(t)&&!isNaN(parseFloat(t))},p.isNaN=function(t){return p.isNumber(t)&&t!==+t},p.isBoolean=function(t){return t===!0||t===!1||"[object Boolean]"===l.call(t)},p.isNull=function(t){return null===t},p.isUndefined=function(t){return void 0===t},p.has=function(t,e){return null!=t&&c.call(t,e)},p.noConflict=function(){return t._=e,this},p.identity=function(t){return t},p.constant=function(t){return function(){return t}},p.noop=function(){},p.property=function(t){return function(e){return e[t]}},p.matches=function(t){var e=p.pairs(t),n=e.length;return function(t){if(null==t)return!n;t=Object(t);for(var a=0;n>a;a++){var i=e[a],r=i[0];if(i[1]!==t[r]||!(r in t))return!1}return!0}},p.times=function(t,e,n){var a=Array(Math.max(0,t));e=f(e,n,1);for(var i=0;t>i;i++)a[i]=e(i);return a},p.random=function(t,e){return null==e&&(e=t,t=0),t+Math.floor(Math.random()*(e-t+1))},p.now=Date.now||function(){return(new Date).getTime()};var w={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},y=p.invert(w),x=function(t){var e=function(e){return t[e]},n="(?:"+p.keys(t).join("|")+")",a=RegExp(n),i=RegExp(n,"g");return function(t){return t=null==t?"":""+t,a.test(t)?t.replace(i,e):t}};p.escape=x(w),p.unescape=x(y),p.result=function(t,e){if(null==t)return void 0;var n=t[e];return p.isFunction(n)?t[e]():n};var j=0;p.uniqueId=function(t){var e=++j+"";return t?t+e:e},p.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var R=/(.)^/,k={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},I=/\\|'|\r|\n|\u2028|\u2029/g,T=function(t){return"\\"+k[t]};p.template=function(t,e,n){!e&&n&&(e=n),e=p.defaults({},e,p.templateSettings);var a=RegExp([(e.escape||R).source,(e.interpolate||R).source,(e.evaluate||R).source].join("|")+"|$","g"),i=0,r="__p+='";t.replace(a,function(e,n,a,s,o){return r+=t.slice(i,o).replace(I,T),i=o+e.length,n?r+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'":a?r+="'+\n((__t=("+a+"))==null?'':__t)+\n'":s&&(r+="';\n"+s+"\n__p+='"),e}),r+="';\n",e.variable||(r="with(obj||{}){\n"+r+"}\n"),r="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+r+"return __p;\n";try{var s=Function(e.variable||"obj","_",r)}catch(o){throw o.source=r,o}var l=function(t){return s.call(this,t,p)},c=e.variable||"obj";return l.source="function("+c+"){\n"+r+"}",l},p.chain=function(t){var e=p(t);return e._chain=!0,e};var U=function(t){return this._chain?p(t).chain():t};p.mixin=function(t){p.each(p.functions(t),function(e){var n=p[e]=t[e];p.prototype[e]=function(){var t=[this._wrapped];return r.apply(t,arguments),U.call(this,n.apply(p,t))}})},p.mixin(p),p.each(["pop","push","reverse","shift","sort","splice","unshift"],function(t){var e=n[t];p.prototype[t]=function(){var n=this._wrapped;return e.apply(n,arguments),"shift"!==t&&"splice"!==t||0!==n.length||delete n[0],U.call(this,n)}}),p.each(["concat","join","slice"],function(t){var e=n[t];p.prototype[t]=function(){return U.call(this,e.apply(this._wrapped,arguments))}}),p.prototype.value=function(){return this._wrapped},"function"==typeof define&&define.amd&&define("underscore",[],function(){return p})}).call(this),this.WildchatDefaultTemplates=this.WildchatDefaultTemplates||{},this.WildchatDefaultTemplates["templates/layout-full.html"]=function(obj){obj||(obj={});var __p="";with(_.escape,obj)__p+="<div id='wildchat' class='full'>\n<div id='wildchat-header' class='clearfix'>\n<div class='clearfix'><div class='half wildchat-dropdown' style=''>\n<a id='wildchat-btn-rooms' class='wildchat-dropdown-toggle btn full' data-toggle=\"wildchat-dropdown\" href='#'>\n<span class='icon user-chat'></span>\nChat Rooms\n<span class='caret'></span>\n</a>\n<div class='wildchat-dropdown-menu full' role='menu'><ul id='wildchat-room-list'></ul><div class='wildchat-dropdown-footer aligncenter'>\n<button type='button' class='btn twothird center' id='wildchat-btn-create-room-prompt'>Create Room</button>\n</div></div></div>\n<div class='half wildchat-dropdown' style=''>\n<a data-event='wildchat-user-search-btn' class='btn full wildchat-dropdown-toggle' data-toggle=\"wildchat-dropdown\" href='#'>\n<span class='icon user-group'></span>\nVisitors\n<span class='caret'></span>\n</a>\n<div class='wildchat-dropdown-menu' role='menu'>\n<div class='wildchat-dropdown-header aligncenter clearfix'>\n<div class='search-wrapper'>\n<span class='icon search'></span>\n<input type='text' data-event='wildchat-user-search' data-template='templates/user-search-list-item.html' data-target='wildchat-user-search' data-controls='wildchat-user-search-controls' class='center fivesixth'>\n</div>\n</div>\n<ul id='wildchat-user-search'></ul><div class='wildchat-dropdown-footer aligncenter clearfix'>\n<div id='wildchat-user-search-controls' class='clearfix'>\n<span class=\"quarter\"></span>\n<button type='button' class='btn half' data-event='wildchat-user-search' data-toggle='wildchat-pagination-next' data-template='templates/user-search-list-item.html' data-target='wildchat-user-search' data-controls='wildchat-user-search-controls' disabled=disabled>Next</button>\n</div><label class='center full'>\n<small>Use \"+ Invite\" button within chat rooms for regular invites.</small>\n</label>\n</div>\n</div>\n</div>\n</div>\n</div>\n<div id='wildchat-tabs' class='clearfix'>\n<ul id='wildchat-tab-list' class='nav nav-tabs clearfix'></ul>\n<div id='wildchat-tab-content' class='tab-content'></div>\n</div><div id='wildchat-footer' class='clearfix'></div>\n</div>";return __p},this.WildchatDefaultTemplates["templates/layout-popout.html"]=function(obj){obj||(obj={});var __p="";with(_.escape,obj)__p+="<div id='wildchat' class='full'>\n<div id='wildchat-tabs' class='clearfix'>\n<ul id='wildchat-tab-list' class='nav nav-tabs clearfix'></ul>\n<div id='wildchat-tab-content' class='tab-content'></div>\n</div>\n</div>";return __p},this.WildchatDefaultTemplates["templates/message-context-menu.html"]=function(obj){obj||(obj={});var __p="",__e=_.escape;with(Array.prototype.join,obj)__p+="<div data-toggle='wildchat-contextmenu' class='contextmenu' data-message-id='"+__e(id)+"'>\n<ul>\n<li><a href='#!' data-event='wildchat-user-warn'>Warn User</a></li>\n",allowKick&&(__p+="\n<li><a href='#!' data-event='wildchat-user-kick'>Kick User</a></li>\n"),__p+="\n<li><a href='#!' data-event='wildchat-user-suspend-hour'>Suspend User (1 Hour)</a></li>\n<li><a href='#!' data-event='wildchat-user-suspend-day'>Suspend User (1 Day)</a></li>\n<li><a href='#!' data-event='wildchat-message-delete'>Delete Message</a></li>\n</ul>\n</div>";return __p},this.WildchatDefaultTemplates["templates/message.html"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(Array.prototype.join,obj)__p+="<div class='message message-"+__e(type)+" ",isSelfMessage&&(__p+=" message-self "),__p+="' data-message-id='"+__e(id)+"' data-user-id='"+__e(userId)+"' data-user-name='"+__e(name)+"' data-class=\"wildchat-message\">\n<div class='clearfix'>\n<label class='fourfifth'>\n<strong class='name' title='"+__e(name)+"'>"+__e(name)+"</strong>\n<em>("+__e(localtime)+")</em>:\n</label>",disableActions||(__p+="\n<label class='fifth alignright'>\n<a href='#!' data-event='wildchat-user-chat' class='icon user-chat' title='Invite to Private Chat'>&nbsp;</a>\n<a href='#!' data-event='wildchat-user-mute-toggle' class='icon user-mute' title='Mute User'>&nbsp;</a>\n</label>\n"),__p+="</div>\n<div class='clearfix message-content'>\n"+(null==(__t=message)?"":__t)+"\n</div>\n</div>";return __p},this.WildchatDefaultTemplates["templates/prompt-alert.html"]=function(obj){obj||(obj={});var __p="",__e=_.escape;with(obj)__p+="<div class='aligncenter clearfix'>\n<h6>"+__e(message)+"</h6>\n<p class='clearfix'>\n<button type='button' class='btn quarter right close'>Close</button>\n</p>\n</div>";return __p},this.WildchatDefaultTemplates["templates/prompt-create-room.html"]=function(obj){obj||(obj={});var __p="",__e=_.escape;with(obj)__p+="<div class='clearfix'>\n<h6>Give your chat room a name:</h6>\n<input data-input='wildchat-room-name' type='text' placeholder='Room name...' style='margin-bottom: 5px;' maxlength='"+__e(maxLengthRoomName)+"'>\n</div>";return __p},this.WildchatDefaultTemplates["templates/prompt-invitation.html"]=function(obj){obj||(obj={});var __p="",__e=_.escape;with(obj)__p+="<div class='aligncenter clearfix'>\n<h5>"+__e(fromUserName)+"</h5>\n<p>invited you to join</p>\n<h5>"+__e(toRoomName)+"</h5>\n<p class='clearfix'>\n<button data-toggle='accept' type='button' class='btn'>Accept</button>\n<button data-toggle='decline' type='button' class='btn'>Decline</button>\n</p>\n</div>";return __p},this.WildchatDefaultTemplates["templates/prompt-invite-private.html"]=function(obj){obj||(obj={});var __p="",__e=_.escape;with(obj)__p+="<div class='aligncenter clearfix'>\n<h6>Invite <strong>"+__e(userName)+"</strong> to "+__e(roomName)+"?</h6>\n<p class='clearfix'>\n<button data-toggle='accept' type='button' class='btn'>Invite</button>\n<button data-toggle='decline' type='button' class='close btn'>Cancel</button>\n</p>\n</div>";return __p},this.WildchatDefaultTemplates["templates/prompt-invite-reply.html"]=function(obj){obj||(obj={});var __p="",__e=_.escape;with(Array.prototype.join,obj)__p+="<div class='aligncenter clearfix'>\n<h5>"+__e(toUserName)+"</h5>\n<p>\n",__p+="accepted"===status?" accepted your invite. ":" declined your invite. ",__p+="\n</p>\n</div>";return __p},this.WildchatDefaultTemplates["templates/prompt-user-mute.html"]=function(obj){obj||(obj={});var __p="",__e=_.escape;with(obj)__p+="<div class='aligncenter clearfix'>\n<h5>"+__e(userName)+"</h5>\n<p class='clearfix'>\n<button data-toggle='accept' type='button' class='btn'>Mute</button>\n<button data-toggle='decline' type='button' class='btn'>Cancel</button>\n</p>\n</div>";return __p},this.WildchatDefaultTemplates["templates/prompt.html"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+="<div class='prompt hidden'>\n<div class='prompt-header'>\n"+__e(title)+"\n<a href='#!' class='close right'>X</a>\n</div>\n<div class='prompt-body clearfix'>\n"+(null==(__t=content)?"":__t)+"\n</div>\n<div class='prompt-footer'></div>\n</div>";return __p},this.WildchatDefaultTemplates["templates/room-list-item.html"]=function(obj){obj||(obj={});var __p="",__e=_.escape;with(Array.prototype.join,obj)__p+="<li data-room-type='"+__e(type)+"' data-room-id='"+__e(id)+"' data-room-name='"+__e(name)+"'>\n<a href='#!' class='clearfix ",isRoomOpen&&(__p+=" highlight "),__p+="'>\n<span class='left' title='"+__e(name)+"'>"+__e(name)+"</span>\n</a>\n</li>";return __p},this.WildchatDefaultTemplates["templates/room-user-list-item.html"]=function(obj){obj||(obj={});var __p="",__e=_.escape;with(Array.prototype.join,obj)__p+="<li data-user-id='"+__e(id)+"' data-user-name='"+__e(name)+"'>\n<a href='#!' class='clearfix'>\n<span class='left twothird clipped' title='"+__e(name)+"'>"+__e(name)+"</span>",disableActions||(__p+="\n<span data-event='wildchat-user-mute-toggle' class='icon user-mute right ",isMuted&&(__p+=" red "),__p+="' title='Toggle User Mute'>&nbsp;</span>\n<span data-event='wildchat-user-chat' class='icon user-chat right' title='Invite to Private Chat'>&nbsp;</span>\n"),__p+="\n</a>\n</li>";return __p},this.WildchatDefaultTemplates["templates/room-user-search-list-item.html"]=function(obj){obj||(obj={});var __p="",__e=_.escape;with(Array.prototype.join,obj)__p+="<li data-user-id='"+__e(id)+"' data-user-name='"+__e(name)+"'>\n<a href='#!' class='clearfix'>\n",__p+=disableActions?"\n<span class='left fourfifth clipped' title='"+__e(name)+"'>"+__e(name)+"</span>\n":"\n<span data-event='wildchat-user-invite' class='left fourfifth clipped' title='"+__e(name)+"'>"+__e(name)+"</span>\n<span data-event='wildchat-user-invite' class='icon plus right' title='Invite to Room'>+</span>\n",__p+="\n</a>\n</li>";return __p},this.WildchatDefaultTemplates["templates/tab-content.html"]=function(obj){obj||(obj={});var __p="",__e=_.escape;with(obj)__p+="<div id='"+__e(id)+"' data-room-id='"+__e(id)+"' class='tab-pane'>\n<div class='tab-pane-menu clearfix'><div class='wildchat-dropdown twofifth'>\n<a data-event='wildchat-user-room-list-btn' class='full btn wildchat-dropdown-toggle' data-toggle=\"wildchat-dropdown\" href='#' data-target='wildchat-room-user-list-"+__e(id)+"'>\n<span class='icon user-group'></span>\nIn Room\n<span class='caret'></span>\n</a>\n<div class='wildchat-dropdown-menu' role='menu'>\n<ul id='wildchat-room-user-list-"+__e(id)+"' class='full'></ul>\n</div>\n</div><div class='wildchat-dropdown twofifth'>\n<a data-event='wildchat-user-search-btn' class='full btn wildchat-dropdown-toggle' data-toggle=\"wildchat-dropdown\" href='#'>\n<span class='icon plus'>+</span>\nInvite\n<span class='caret'></span>\n</a><div class='wildchat-dropdown-menu' role='menu'>\n<div class='wildchat-dropdown-header aligncenter clearfix'>\n<div class='search-wrapper'>\n<span class='icon search'></span>\n<input type='text' data-event='wildchat-user-search' data-template='templates/room-user-search-list-item.html' data-target='wildchat-room-user-search-"+__e(id)+"' data-controls='wildchat-room-user-search-controls-"+__e(id)+"' class='center fivesixth'>\n</div>\n</div>\n<ul id='wildchat-room-user-search-"+__e(id)+"'></ul><div class='wildchat-dropdown-footer aligncenter clearfix'>\n<div id='wildchat-room-user-search-controls-"+__e(id)+"' class='clearfix'><span class=\"quarter\"></span>\n<!--\n<button type='button' class='btn third disabled' data-event='wildchat-user-search' data-template='templates/room-user-search-list-item.html' data-target='wildchat-room-user-search-"+__e(id)+"' data-controls='wildchat-room-user-search-controls-"+__e(id)+"' data-toggle='wildchat-pagination-prev' disabled=disabled>Prev</button>\n-->\n<button type='button' class='btn half disabled' data-event='wildchat-user-search' data-template='templates/room-user-search-list-item.html' data-target='wildchat-room-user-search-"+__e(id)+"' data-controls='wildchat-room-user-search-controls-"+__e(id)+"' data-toggle='wildchat-pagination-next'  disabled=disabled>Next</button>\n</div>\n</div>\n</div>\n</div><a href='#!' data-event='wildchat-close-tab' class='icon close right' style='15px 5px' title='Leave Room'></a></div><div class='clearfix'>\n<div id='wildchat-messages"+__e(id)+"' class='chat'></div>\n</div><div class='clearfix'>\n<label>Your message:</label>\n<textarea id='textarea"+__e(id)+"' placeholder='Type your message here...'></textarea>\n</div>\n</div>";return __p},this.WildchatDefaultTemplates["templates/tab-menu-item.html"]=function(obj){obj||(obj={});var __p="",__e=_.escape;with(obj)__p+="<li data-room-id='"+__e(id)+"'>\n<a href='#"+__e(id)+"' data-toggle='wildchat-tab' title='"+__e(name)+"'>"+__e(name)+"</a>\n</li>";return __p},this.WildchatDefaultTemplates["templates/user-search-list-item.html"]=function(obj){obj||(obj={});var __p="",__e=_.escape;with(Array.prototype.join,obj)__p+="<li data-user-id='"+__e(id)+"' data-user-name='"+__e(name)+"'>\n<a href='#!' class='clearfix'>\n",__p+=disableActions?"\n<span class='left fivesixth clipped' title='"+__e(name)+"'>"+__e(name)+"</span>\n":"\n<span data-event='wildchat-user-chat' class='left fivesixth clipped' title='"+__e(name)+"'>"+__e(name)+"</span>\n<span data-event='wildchat-user-chat' class='icon user-chat right' title='Invite to Private Chat'>&nbsp;</span>\n",__p+="\n</a>\n</li>";return __p},function(){Function.prototype.bind||(Function.prototype.bind=function(t){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var e=Array.prototype.slice.call(arguments,1),n=this,a=function(){},i=function(){return n.apply(this instanceof a&&t?this:t,e.concat(Array.prototype.slice.call(arguments)))};return a.prototype=this.prototype,i.prototype=new a,i}),Object.keys=Object.keys||function(t){var e=[];for(var n in t)t.hasOwnProperty(n)&&e.push(n);return e}}(),function(t){function e(t,e){this._wilddog=t,this._user=null,this._userId=null,this._userName=null,this._isModerator=!1,this._sessionId=null,this._events={},this._rooms={},this._presenceBits={},this._userRef=null,this._messageRef=this._wilddog.child("room-messages"),this._roomRef=this._wilddog.child("room-metadata"),this._privateRoomRef=this._wilddog.child("room-private-metadata"),this._moderatorsRef=this._wilddog.child("moderators"),this._suspensionsRef=this._wilddog.child("suspensions"),this._usersOnlineRef=this._wilddog.child("user-names-online"),this._options=e||{},this._options.numMaxMessages=this._options.numMaxMessages||50}var n=this,a=n.Wildchat;e.noConflict=function(){return n.Wildchat=a,e},n.Wildchat=e,e.prototype={_loadUserMetadata:function(t){var e=this;this._userRef.transaction(function(t){return t&&t.id&&t.name?void 0:{id:e._userId,name:e._userName}},function(a,i,r){e._user=r.val(),e._moderatorsRef.child(e._userId).once("value",function(a){e._isModerator=!!a.val(),n.setTimeout(t,0)})})},_setupDataEvents:function(){this._wilddog.root().child(".info/connected").on("value",function(t){if(t.val()===!0)for(var e=0;this._presenceBits>e;e++){var n=this._presenceBits[e],a=this._wilddog.root().child(n.ref);a.onDisconnect().set(n.offlineValue),a.set(n.onlineValue)}},this);var t=this._userRef.child("sessions").push();this._sessionId=t.key(),this._queuePresenceOperation(t,!0,null);var e=this._usersOnlineRef.child(this._userName.toLowerCase()),n=e.child(this._sessionId);this._queuePresenceOperation(n,{id:this._userId,name:this._userName},null),this._userRef.on("value",this._onUpdateUser,this),this._userRef.child("invites").on("child_added",this._onWildchatInvite,this),this._userRef.child("notifications").on("child_added",this._onNotification,this)},_addEventCallback:function(t,e){this._events[t]=this._events[t]||[],this._events[t].push(e)},_getEventCallbacks:function(t){return this._events.hasOwnProperty(t)?this._events[t]:[]},_invokeEventCallbacks:function(t){var e=[],n=this._getEventCallbacks(t);Array.prototype.push.apply(e,arguments),e=e.slice(1);for(var a=0;n.length>a;a+=1)n[a].apply(null,e)},_queuePresenceOperation:function(t,e,n){t.onDisconnect().set(n),t.set(e),this._presenceBits[""+t]={ref:t,onlineValue:e,offlineValue:n}},_removePresenceOperation:function(e,n){var a=new t(e);a.onDisconnect().cancel(),a.set(n),delete this._presenceBits[e]},_onUpdateUser:function(t){this._user=t.val(),this._invokeEventCallbacks("user-update",this._user)},_onAuthRequired:function(){this._invokeEventCallbacks("auth-required")},_onEnterRoom:function(t){this._invokeEventCallbacks("room-enter",t)},_onNewMessage:function(t,e){var n=e.val();n.id=e.key(),this._invokeEventCallbacks("message-add",t,n)},_onRemoveMessage:function(t,e){var n=e.key();this._invokeEventCallbacks("message-remove",t,n)},_onLeaveRoom:function(t){this._invokeEventCallbacks("room-exit",t)},_onNotification:function(t){var e=t.val();e.read||(("suspension"!==e.notificationType||e.data.suspendedUntil<(new Date).getTime())&&t.ref().child("read").set(!0),this._invokeEventCallbacks("notification",e))},_onWildchatInvite:function(t){var e=this,n=t.val();n.status||(n.id=n.id||t.key(),e.getRoom(n.roomId,function(t){n.toRoomName=t.name,e._invokeEventCallbacks("room-invite",n)}))},_onWildchatInviteResponse:function(t){var e=t.val();e.id=e.id||t.key(),this._invokeEventCallbacks("room-invite-response",e)}},e.prototype.setUser=function(t,e,a){var i=this;i._wilddog.onAuth(function(r){r?(i._userId=""+t,i._userName=""+e,i._userRef=i._wilddog.child("users").child(i._userId),i._loadUserMetadata(function(){n.setTimeout(function(){a(i._user),i._setupDataEvents()},0)})):i.warn("Wildchat requires an authenticated Wilddog reference. Pass an authenticated reference before loading.")})},e.prototype.resumeSession=function(){this._userRef.child("rooms").once("value",function(t){var e=t.val();for(var n in e)this.enterRoom(e[n].id)
},function(){},this)},e.prototype.on=function(t,e){this._addEventCallback(t,e)},e.prototype.createRoom=function(e,n,a){var i=this,r=this._roomRef.push(),s={id:r.key(),name:e,type:n||"public",createdByUserId:this._userId,createdAt:t.ServerValue.TIMESTAMP};"private"===n&&(s.authorizedUsers={},s.authorizedUsers[this._userId]=!0),r.set(s,function(t){t||i.enterRoom(r.key()),a&&a(r.key())})},e.prototype.enterRoom=function(t){var e=this;e.getRoom(t,function(n){var a=n.name;if(t&&a&&!e._rooms[t]){if(e._rooms[t]=!0,e._user){e._userRef.child("rooms").child(t).set({id:t,name:a,active:!0});var i=e._wilddog.child("room-users").child(t).child(e._userId).child(e._sessionId);e._queuePresenceOperation(i,{id:e._userId,name:e._userName},null)}e._onEnterRoom({id:t,name:a}),e._roomRef.child(t).once("value",function(){e._messageRef.child(t).limitToLast(e._options.numMaxMessages).on("child_added",function(n){e._onNewMessage(t,n)},function(){e.leaveRoom(t)},e),e._messageRef.child(t).limitToLast(e._options.numMaxMessages).on("child_removed",function(n){e._onRemoveMessage(t,n)},function(){},e)},function(){},e)}})},e.prototype.leaveRoom=function(t){var e=this,n=e._wilddog.child("room-users").child(t);if(e._messageRef.child(t).off(),e._user){var a=n.child(e._userId).child(e._sessionId);e._removePresenceOperation(""+a,null),e._userRef.child("rooms").child(t).remove()}delete e._rooms[t],e._onLeaveRoom(t)},e.prototype.sendMessage=function(e,n,a,i){var r,s=this,o={userId:s._userId,name:s._userName,timestamp:t.ServerValue.TIMESTAMP,message:n,type:a||"default"};return s._user?(r=s._messageRef.child(e).push(),r.setWithPriority(o,t.ServerValue.TIMESTAMP,i),void 0):(s._onAuthRequired(),i&&i(Error("Not authenticated or user not set!")),void 0)},e.prototype.deleteMessage=function(t,e,n){var a=this;a._messageRef.child(t).child(e).remove(n)},e.prototype.toggleUserMute=function(t,e){var n=this;return n._user?(n._userRef.child("muted").child(t).transaction(function(t){return t?null:!0},e),void 0):(n._onAuthRequired(),e&&e(Error("Not authenticated or user not set!")),void 0)},e.prototype.sendSuperuserNotification=function(e,n,a,i){var r=this,s=r._wilddog.child("users").child(e).child("notifications");s.push({fromUserId:r._userId,timestamp:t.ServerValue.TIMESTAMP,notificationType:n,data:a||{}},i)},e.prototype.warnUser=function(t){var e=this;e.sendSuperuserNotification(t,"warning")},e.prototype.suspendUser=function(t,e,n){var a=this,i=(new Date).getTime()+1e3*e;a._suspensionsRef.child(t).set(i,function(e){return e&&n?n(e):(a.sendSuperuserNotification(t,"suspension",{suspendedUntil:i}),n(null))})},e.prototype.inviteUser=function(t,e){var n=this,a=function(){var a=n._wilddog.child("users").child(t).child("invites").push();a.set({id:a.key(),fromUserId:n._userId,fromUserName:n._userName,roomId:e}),a.on("value",n._onWildchatInviteResponse,function(){},n)};return n._user?(n.getRoom(e,function(i){if("private"===i.type){var r=n._roomRef.child(e).child("authorizedUsers");r.child(t).set(!0,function(t){t||a()})}else a()}),void 0):(n._onAuthRequired(),void 0)},e.prototype.acceptInvite=function(t,e){var n=this;n._userRef.child("invites").child(t).once("value",function(a){var i=a.val();return null===i&&e?e(Error("acceptInvite("+t+"): invalid invite id")):(n.enterRoom(i.roomId),n._userRef.child("invites").child(t).update({status:"accepted",toUserName:n._userName},e),void 0)},n)},e.prototype.declineInvite=function(t,e){var n=this,a={status:"declined",toUserName:n._userName};n._userRef.child("invites").child(t).update(a,e)},e.prototype.getRoomList=function(t){var e=this;e._roomRef.once("value",function(e){t(e.val())})},e.prototype.getUsersByRoom=function(){var t=this,e=arguments[0],a=t._wilddog.child("room-users").child(e),i=arguments[arguments.length-1],r=null;arguments.length>2&&(r=arguments[1]),a=r?a.limitToLast(r):a,a.once("value",function(t){var e=t.val()||{},a={};for(var r in e)for(var s in e[r]){a[r]=e[r][s];break}n.setTimeout(function(){i(a)},0)})},e.prototype.getUsersByPrefix=function(t,e,a,i,r){var s=this._usersOnlineRef,o=t.toLowerCase();s=e?s.startAt(null,e):a?s.endAt(null,a):o?s.startAt(null,o):s.startAt(),s=i?s.limitToLast(i):s,s.once("value",function(e){var a=e.val()||{},i={};for(var s in a){var l,c,u=a[s];for(var d in u){l=u[d].name,c=u[d].id;break}t.length>0&&0!==l.toLowerCase().indexOf(o)||(i[l]={name:l,id:c})}n.setTimeout(function(){r(i)},0)})},e.prototype.getRoom=function(t,e){this._roomRef.child(t).once("value",function(t){e(t.val())})},e.prototype.userIsModerator=function(){return this._isModerator},e.prototype.warn=function(t){console&&(t="Wildchat Warning: "+t,"function"==typeof console.warn?console.warn(t):"function"==typeof console.log&&console.log(t))}}(Wilddog),function(t){function e(e,n,a){if(!e)throw Error("WildchatUI: Missing required argument `wilddogRef`");if(!n)throw Error("WildchatUI: Missing required argument `el`");a=a||{},this._options=a,this._el=n,this._user=null,this._chat=new Wildchat(e,a),this._roomQueue=[],this.maxLengthUsername=15,this.maxLengthUsernameDisplay=15,this.maxLengthRoomName=24,this.maxLengthMessage=120,this.maxUserSearchResults=100,this.urlPattern=/\b(?:https?|ftp):\/\/[a-z0-9-+&@#\/%?=~_|!:,.;]*[a-z0-9-+&@#\/%=~_|]/gim,this.pseudoUrlPattern=/(^|[^\/])(www\.[\S]+(\b|$))/gim,this._renderLayout(),this.$wrapper=t("#wildchat"),this.$roomList=t("#wildchat-room-list"),this.$tabList=t("#wildchat-tab-list"),this.$tabContent=t("#wildchat-tab-content"),this.$messages={},this.$rateLimit={limitCount:10,limitInterval:1e4,limitWaitTime:3e4,history:{}},this._bindUIEvents(),this._bindDataEvents()}if(!t||170>parseInt(t().jquery.replace(/\./g,""),10))throw Error("jQuery 1.7 or later required!");var n=this,a=n.WildchatUI;if(n.WildchatUI=e,!self.WildchatDefaultTemplates)throw Error("Unable to find chat templates!");e.noConflict=function(){return n.WildchatUI=a,e},e.prototype={_bindUIEvents:function(){this._bindForHeightChange(),this._bindForTabControls(),this._bindForRoomList(),this._bindForUserRoomList(),this._bindForUserSearch(),this._bindForUserMuting(),this._bindForChatInvites(),this._bindForRoomListing(),this._setupTabs(),this._setupDropdowns(),this._bindTextInputFieldLimits()},_bindDataEvents:function(){this._chat.on("user-update",this._onUpdateUser.bind(this)),this._chat.on("room-enter",this._onEnterRoom.bind(this)),this._chat.on("room-exit",this._onLeaveRoom.bind(this)),this._chat.on("message-add",this._onNewMessage.bind(this)),this._chat.on("message-remove",this._onRemoveMessage.bind(this)),this._chat.on("room-invite",this._onChatInvite.bind(this)),this._chat.on("room-invite-response",this._onChatInviteResponse.bind(this)),this._chat.on("notification",this._onNotification.bind(this))},_renderLayout:function(){var e=WildchatDefaultTemplates["templates/layout-full.html"];t(this._el).html(e({maxLengthUsername:this.maxLengthUsername}))},_onUpdateUser:function(e){this._user=e;var n=this._user.muted||{};t('[data-event="wildchat-user-mute-toggle"]').each(function(){var e=t(this).closest("[data-user-id]").data("user-id");t(this).toggleClass("red",!!n[e])});for(var a in n)t('.message[data-user-id="'+a+'"]').fadeOut()},_onEnterRoom:function(t){this.attachTab(t.id,t.name)},_onLeaveRoom:function(t){this.removeTab(t),this._roomQueue.length>0&&this._chat.enterRoom(this._roomQueue.shift(t))},_onNewMessage:function(t,e){var n=e.userId;this._user&&this._user.muted&&this._user.muted[n]||this.showMessage(t,e)},_onRemoveMessage:function(t,e){this.removeMessage(t,e)},_onChatInvite:function(t){var e=this,n=WildchatDefaultTemplates["templates/prompt-invitation.html"],a=this.prompt("Invite",n(t));a.find("a.close").click(function(){return a.remove(),e._chat.declineInvite(t.id),!1}),a.find("[data-toggle=accept]").click(function(){return a.remove(),e._chat.acceptInvite(t.id),!1}),a.find("[data-toggle=decline]").click(function(){return a.remove(),e._chat.declineInvite(t.id),!1})},_onChatInviteResponse:function(t){if(t.status){var e,n=this,a=WildchatDefaultTemplates["templates/prompt-invite-reply.html"];t.status&&"accepted"===t.status?(e=this.prompt("Accepted",a(t)),this._chat.getRoom(t.roomId,function(e){n.attachTab(t.roomId,e.name)})):e=this.prompt("Declined",a(t)),e.find("a.close").click(function(){return e.remove(),!1})}},_onNotification:function(t){if("warning"===t.notificationType)this.renderAlertPrompt("Warning","You are being warned for inappropriate messaging. Further violation may result in temporary or permanent ban of service.");else if("suspension"===t.notificationType){var e=t.data.suspendedUntil,n=Math.round((e-(new Date).getTime())/1e3),a="";if(n>0){if(n>7200){var i=Math.floor(n/3600);a=i+" hours, ",n-=3600*i}a+=Math.floor(n/60)+" minutes",this.renderAlertPrompt("Suspended","A moderator has suspended you for violating site rules. You cannot send messages for another "+a+".")}}}},e.prototype.setUser=function(t,e){var n=this;n._chat.setUser(t,e,function(t){n._user=t,n._chat.userIsModerator()&&n._bindSuperuserUIEvents(),n._chat.resumeSession()})},e.prototype.on=function(t,e){this._chat.on(t,e)},e.prototype._bindSuperuserUIEvents=function(){var e=this,n=function(){var e=t(this),n=e.closest("[data-message-id]").data("message-id"),a=t('[data-message-id="'+n+'"]').closest("[data-user-id]").data("user-id"),i=t('[data-message-id="'+n+'"]').closest("[data-room-id]").data("room-id");return{messageId:n,userId:a,roomId:i}},a=function(){t('[data-toggle="wildchat-contextmenu"]').each(function(){t(this).remove()}),t("#wildchat .message.highlighted").each(function(){t(this).removeClass("highlighted")})},i=function(i){var r,s=t(this),o=s.closest("[data-message-id]"),l=WildchatDefaultTemplates["templates/message-context-menu.html"],c=n.call(this,i);i.preventDefault(),a(),s.addClass("highlighted"),e._chat.getRoom(c.roomId,function(){r=t(l({id:o.data("message-id")})),r.css({left:i.clientX,top:i.clientY}).appendTo(e.$wrapper)})};t(document).bind("click",{self:this},function(t){t.button&&2==t.button||a()}),t(document).delegate('[data-class="wildchat-message"]',"contextmenu",i),t(document).delegate('[data-event="wildchat-user-warn"]',"click",function(t){var a=n.call(this,t);e._chat.warnUser(a.userId)}),t(document).delegate('[data-event="wildchat-user-suspend-hour"]',"click",function(t){var a=n.call(this,t);e._chat.suspendUser(a.userId,3600)}),t(document).delegate('[data-event="wildchat-user-suspend-day"]',"click",function(t){var a=n.call(this,t);e._chat.suspendUser(a.userId,86400)}),t(document).delegate('[data-event="wildchat-message-delete"]',"click",function(t){var a=n.call(this,t);e._chat.deleteMessage(a.roomId,a.messageId)})},e.prototype._bindForHeightChange=function(){var e=t(this._el),n=null;setInterval(function(){var a=e.height();a!=n&&(n=a,t(".chat").each(function(){}))},500)},e.prototype._bindForTabControls=function(){var e=this;t(document).delegate('[data-event="wildchat-close-tab"]',"click",function(){var n=t(this).closest("[data-room-id]").data("room-id");return e._chat.leaveRoom(n),!1})},e.prototype._bindForRoomList=function(){var e=this;t("#wildchat-btn-rooms").bind("click",function(){if(!t(this).parent().hasClass("open")){var n=(t(this),WildchatDefaultTemplates["templates/room-list-item.html"]),a=function(){var n=t(this).parent(),a=n.data("room-id"),i=n.data("room-name");return e.$messages[a]?e.focusTab(a):e._chat.enterRoom(a,i),!1};e._chat.getRoomList(function(i){e.$roomList.empty();for(var r in i){var s=i[r];if("public"==s.type){s.isRoomOpen=!!e.$messages[s.id];var o=t(n(s));o.children("a").bind("click",a),e.$roomList.append(o.toggle(!0))}}})}})},e.prototype._bindForUserRoomList=function(){var e=this;t(document).delegate('[data-event="wildchat-user-room-list-btn"]',"click",function(n){n.stopPropagation();var a=t(this),i=a.closest("[data-room-id]").data("room-id"),r=WildchatDefaultTemplates["templates/room-user-list-item.html"],s=a.data("target"),o=t("#"+s);o.empty(),e._chat.getUsersByRoom(i,function(n){for(var a in n)user=n[a],user.disableActions=!e._user||user.id===e._user.id,user.nameTrimmed=e.trimWithEllipsis(user.name,e.maxLengthUsernameDisplay),user.isMuted=e._user&&e._user.muted&&e._user.muted[user.id],o.append(t(r(user)));e.sortListLexicographically("#"+s)})})},e.prototype._bindForUserSearch=function(){var e=this,n=function(e){var n=t(this),i=n.data("target"),r=n.data("controls"),s=n.data("template"),o=n.val()||n.data("prefix")||"",l=n.data("startAt")||null,c=n.data("endAt")||null;e.preventDefault(),a(i,s,r,o,l,c)},a=function(n,a,i,r,s,o){var l=t("#"+n),c=t("#"+i),u=WildchatDefaultTemplates[a];e._chat.getUsersByPrefix(r,s,o,e.maxUserSearchResults,function(t){var n,a,i,s,o,d=0;l.empty();for(i in t){var h=t[i];if(h.disableActions=!e._user||h.id===e._user.id,d+=1,l.append(u(h)),1===d)s=h.name.toLowerCase();else if(d>=e.maxUserSearchResults){o=h.name.toLowerCase();break}}c&&(n=c.find('[data-toggle="wildchat-pagination-prev"]'),a=c.find('[data-toggle="wildchat-pagination-next"]'),o?a.data("event","wildchat-user-search").data("startAt",o).data("prefix",r).removeClass("disabled").removeAttr("disabled"):a.data("event",null).data("startAt",null).data("prefix",null).addClass("disabled").attr("disabled","disabled"))})};t(document).delegate('[data-event="wildchat-user-search"]',"keyup",n),t(document).delegate('[data-event="wildchat-user-search"]',"click",n),t(document).delegate('[data-event="wildchat-user-search-btn"]',"click",function(e){e.stopPropagation();var n=t(this).next("div.wildchat-dropdown-menu").find("input");n.focus(),n.trigger(jQuery.Event("keyup"))}),t(document).delegate('[data-event="wildchat-user-search"]',"click",function(t){t.stopPropagation()})},e.prototype._bindForUserMuting=function(){var e=this;t(document).delegate('[data-event="wildchat-user-mute-toggle"]',"click",function(n){var a=t(this),i=a.closest("[data-user-id]").data("user-id"),r=a.closest("[data-user-name]").data("user-name"),s=a.hasClass("red"),o=WildchatDefaultTemplates["templates/prompt-user-mute.html"];if(n.preventDefault(),s)e._chat.toggleUserMute(i);else{var l=e.prompt("Mute User?",o({userName:r}));l.find("a.close").first().click(function(){return l.remove(),!1}),l.find("[data-toggle=decline]").first().click(function(){return l.remove(),!1}),l.find("[data-toggle=accept]").first().click(function(){return e._chat.toggleUserMute(i),l.remove(),!1})}})},e.prototype._bindForChatInvites=function(){var e=this,n=function(){var n,a=t(this),i=a.closest("[data-user-id]").data("user-id"),r=a.closest("[data-room-id]").data("room-id"),s=a.closest("[data-user-name]").data("user-name"),o=WildchatDefaultTemplates["templates/prompt-invite-private.html"];return e._chat.getRoom(r,function(t){return n=e.prompt("Invite",o({userName:s,roomName:t.name})),n.find("a.close").click(function(){return n.remove(),!1}),n.find("[data-toggle=decline]").click(function(){return n.remove(),!1}),n.find("[data-toggle=accept]").first().click(function(){return n.remove(),e._chat.inviteUser(i,r,t.name),!1}),!1}),!1},a=function(){var n,a=t(this),i=a.closest("[data-user-id]").data("user-id"),r=a.closest("[data-user-name]").data("user-name"),s=WildchatDefaultTemplates["templates/prompt-invite-private.html"];return i&&r&&(n=e.prompt("Private Invite",s({userName:r,roomName:"Private Chat"})),n.find("a.close").click(function(){return n.remove(),!1}),n.find("[data-toggle=decline]").click(function(){return n.remove(),!1}),n.find("[data-toggle=accept]").first().click(function(){n.remove();var t="Private Chat";return e._chat.createRoom(t,"private",function(n){e._chat.inviteUser(i,n,t)}),!1})),!1};t(document).delegate('[data-event="wildchat-user-chat"]',"click",a),t(document).delegate('[data-event="wildchat-user-invite"]',"click",n)},e.prototype._bindForRoomListing=function(){var e=this,n=t("#wildchat-btn-create-room-prompt"),a=t("#wildchat-btn-create-room");n.bind("click",function(){return e.promptCreateRoom(),!1}),a.bind("click",function(){var n=t("#wildchat-input-room-name").val();return t("#wildchat-prompt-create-room").remove(),e._chat.createRoom(n),!1})},e.prototype._setupTabs=function(){var e=function(e){var a,i,r=e,s=r.closest("ul:not(.wildchat-dropdown-menu)"),o=r.attr("data-target"),l=s.find(".active:last a")[0];o||(o=r.attr("href"),o=o&&o.replace(/.*(?=#[^\s]*$)/,"")),r.parent("li").hasClass("active")||(i=t.Event("show",{relatedTarget:l}),r.trigger(i),i.isDefaultPrevented()||(a=t(o),n(r.parent("li"),s),n(a,a.parent(),function(){r.trigger({type:"shown",relatedTarget:l})})))},n=function(e,n,a){function i(){r.removeClass("active").find("> .wildchat-dropdown-menu > .active").removeClass("active"),e.addClass("active"),s?e.addClass("in"):e.removeClass("fade"),e.parent(".wildchat-dropdown-menu")&&e.closest("li.wildchat-dropdown").addClass("active"),a&&a()}var r=n.find("> .active"),s=a&&t.support.transition&&r.hasClass("fade");s?r.one(t.support.transition.end,i):i(),r.removeClass("in")};t(document).delegate('[data-toggle="wildchat-tab"]',"click",function(n){n.preventDefault(),e(t(this))})},e.prototype._setupDropdowns=function(){var e=function(){var e=t(this),i=a(e),r=i.hasClass("open");if(!e.is(".disabled, :disabled"))return n(),r||i.toggleClass("open"),e.focus(),!1},n=function(){t("[data-toggle=wildchat-dropdown]").each(function(){a(t(this)).removeClass("open")})},a=function(e){var n,a=e.attr("data-target");return a||(a=e.attr("href"),a=a&&/#/.test(a)&&a.replace(/.*(?=#[^\s]*$)/,"")),n=a&&t(a),n&&n.length||(n=e.parent()),n};t(document).bind("click",n).delegate(".wildchat-dropdown-menu","click",function(t){t.stopPropagation()}).delegate("[data-toggle=wildchat-dropdown]","click",e)},e.prototype._bindTextInputFieldLimits=function(){t("body").delegate('input[data-provide="limit"], textarea[data-provide="limit"]',"keyup",function(){var e=t(this),n=t(e.data("counter")),a=e.attr("maxlength"),i=e.val().length;n.html(Math.max(0,a-i))})},e.prototype.renderAlertPrompt=function(t,e){var n=WildchatDefaultTemplates["templates/prompt-alert.html"],a=this.prompt(t,n({message:e}));a.find(".close").click(function(){return a.remove(),!1})},e.prototype.toggleInputs=function(e){t("#wildchat-tab-content textarea").each(function(){var n=t(this);e?t(this).val(""):t(this).val("You have exceeded the message limit, please wait before sending."),n.prop("disabled",!e)}),t("#wildchat-input-name").prop("disabled",!e)},e.prototype.attachTab=function(e,n){var a=this;if(this.$messages[e])return this.focusTab(e),void 0;var i={id:e,name:n},r=WildchatDefaultTemplates["templates/tab-content.html"],s=t(r(i));this.$tabContent.prepend(s);var o=t("#wildchat-messages"+e);this.$messages[e]=o;var l=s.find("textarea").first();l.bind("keydown",function(t){var n=a.trimWithEllipsis(l.val(),a.maxLengthMessage);return 13===t.which&&""!==n?(l.val(""),a._chat.sendMessage(e,n),!1):void 0});var c=WildchatDefaultTemplates["templates/tab-menu-item.html"],u=t(c(i));this.$tabList.prepend(u),u.bind("shown",function(){o.scrollTop(o[0].scrollHeight)});var d=this.$tabList.children("li"),h=Math.floor(t("#wildchat-tab-list").width()/d.length);this.$tabList.children("li").css("width",h),this.$roomList.children("[data-room-id="+e+"]").children("a").addClass("highlight"),t("#wildchat-btn-room-user-list-"+e).bind("click",function(){return a.sortListLexicographically("#wildchat-room-user-list-"+e),!1}),this.focusTab(e)},e.prototype.focusTab=function(t){if(this.$messages[t]){var e=this.$tabList.find("[data-room-id="+t+"]").find("a");e.length&&e.first().trigger("click")}},e.prototype.removeTab=function(e){delete this.$messages[e],this.$tabContent.find("[data-room-id="+e+"]").remove(),this.$tabList.find("[data-room-id="+e+"]").remove();var n=this.$tabList.children("li"),a=Math.floor(t("#wildchat-tab-list").width()/n.length);this.$tabList.children("li").css("width",a),this.$tabList.find('[data-toggle="wildchat-tab"]').first().trigger("click"),this.$roomList.children("[data-room-id="+e+"]").children("a").removeClass("highlight")},e.prototype.showMessage=function(e,n){var a=this,i={id:n.id,localtime:a.formatTime(n.timestamp),message:n.message||"",userId:n.userId,name:n.name,type:n.type||"default",isSelfMessage:a._user&&n.userId==a._user.id,disableActions:!a._user||n.userId==a._user.id};i.message=_.map(i.message.split(" "),function(t){return a.urlPattern.test(t)||a.pseudoUrlPattern.test(t)?a.linkify(encodeURI(t)):_.escape(t)}).join(" "),i.message=a.trimWithEllipsis(i.message,a.maxLengthMessage);var r=WildchatDefaultTemplates["templates/message.html"],s=t(r(i)),o=a.$messages[e];if(o){var l=!1;o.scrollTop()/(o[0].scrollHeight-o[0].offsetHeight)>=.95?l=!0:o[0].scrollHeight<=o.height()&&(l=!0),o.append(s),l&&o.scrollTop(o[0].scrollHeight)}},e.prototype.removeMessage=function(e,n){t('.message[data-message-id="'+n+'"]').remove()},e.prototype.sortListLexicographically=function(e){t(e).children("li").sort(function(e,n){var a=t(e).text().toUpperCase(),i=t(n).text().toUpperCase();return i>a?-1:a>i?1:0}).appendTo(e)},e.prototype.trimWithEllipsis=function(t,e){return t=t.replace(/^\s\s*/,"").replace(/\s\s*$/,""),e&&e>=t.length?t:t.substring(0,e)+"..."},e.prototype.formatTime=function(t){var e=t?new Date(t):new Date,n=e.getHours()||12,a=""+e.getMinutes(),i=e.getHours()>=12?"pm":"am";return n=n>12?n-12:n,a=2>a.length?"0"+a:a,""+n+":"+a+i},e.prototype.promptCreateRoom=function(){var t=this,e=WildchatDefaultTemplates["templates/prompt-create-room.html"],n=this.prompt("Create Public Room",e({maxLengthRoomName:this.maxLengthRoomName,isModerator:t._chat.userIsModerator()}));n.find("a.close").first().click(function(){return n.remove(),!1}),n.find("[data-toggle=submit]").first().click(function(){var e=n.find("[data-input=wildchat-room-name]").first().val();return""!==e&&(t._chat.createRoom(e,"public"),n.remove()),!1}),n.find("[data-input=wildchat-room-name]").first().focus(),n.find("[data-input=wildchat-room-name]").first().bind("keydown",function(e){if(13===e.which){var a=n.find("[data-input=wildchat-room-name]").first().val();if(""!==a)return t._chat.createRoom(a,"public"),n.remove(),!1}})},e.prototype.prompt=function(e,n){var a,i=WildchatDefaultTemplates["templates/prompt.html"];return a=t(i({title:e,content:n})).css({top:this.$wrapper.position().top+.333*this.$wrapper.height(),left:this.$wrapper.position().left+.125*this.$wrapper.width(),width:.75*this.$wrapper.width()}),this.$wrapper.append(a.removeClass("hidden")),a},e.prototype.linkify=function(t){var e=this;return t.replace(e.urlPattern,'<a target="_blank" href="$&">$&</a>').replace(e.pseudoUrlPattern,'$1<a target="_blank" href="http://$2">$2</a>')}}(jQuery);